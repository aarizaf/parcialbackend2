// Prisma Schema - LibraryApp
// Define la estructura de la base de datos para gestión de libros y autores

// Configuración del generador de Prisma Client
generator client {
  provider = "prisma-client-js"
}

// Configuración de la conexión a la base de datos
// La URL viene de la variable de entorno DATABASE_URL
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo Author - Representa la tabla de autores
model Author {
  id        String   @id @default(uuid())
  name      String   @unique // Nombre único para evitar duplicados
  birthYear Int      @map("birth_year")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relación: un autor puede tener muchos libros
  books     Book[]

  @@map("authors") // Nombre de la tabla en la base de datos
}

// Modelo Book - Representa la tabla de libros
model Book {
  id        String   @id @default(uuid())
  title     String
  year      Int
  authorId  String   @map("author_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relación: cada libro pertenece a un autor
  author    Author   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  // Índice para mejorar búsquedas por autor
  @@index([authorId])
  // Índice compuesto para evitar duplicados: mismo título del mismo autor
  @@unique([title, authorId])
  @@map("books") // Nombre de la tabla en la base de datos
}
